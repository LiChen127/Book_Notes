# 第十二条

我们了解到零值可用对于编写出符合Go惯用法的代码是大有裨益的。但有些时候，零值并非最好的选择，我们有必要为变量赋予适当的初值以保证其后续以正确的状态参与业务流程计算，尤其是Go语言中的一些复合类型的变量。

Go提供的复合字面值（composite literal）语法可以作为复合类型变量的初值构造器。

```go
s := myStruct{ "tony", 23 }
a := [5]int { 13, 14, 15, 15, 16 }
sl := []int { 23, 24, 25, 26 }
m := map[int]string { 1: "hello", 2: "gopher" }
```

复合字面值由两部分组成:

1. 类型
2. 大括号包裹的字面值

## 结构体复合字面值

go vet工具中内置了一条检查规则: composites。

这条规则用于检查源码中使用复合字面值对结构体类型变量赋值的行为。

如果源码中使用了从另一个包中导入的struct类型，但却未使用field:value形式的初值构造器，则该规则认为这样的复合字面值是脆弱的。因为一旦该结构体类型增加了一个新的字段，即使是未导出的，这种值构造方式也将导致编译失败

```go
// 错误示范
err = &net.DNSConfigError{err}

// 应该是
err = &net.DNSConfigError{ Err: err }
```

显然，Go推荐使用field:value的复合字面值形式对struct类型变量进行值构造，这种值构造方式可以降低结构体类型使用者与结构体类型设计者之间的耦合，这也是Go语言的惯用法。

这种field:value形式的复合字面值初值构造器颇为强大。与之前普通复合字面值形式不同，field:value形式字面值中的字段可以以任意次序出现，未显式出现在字面值的结构体中的字段将采用其对应类型的零值。

## 数组/切片复合字面值

与结构体不同，数组/切片使用下标(index)作为field:value形式中的field，从而实现数组/切片初始元素值得高级构造形式

不同于结构体复合字面值较多采用field:value形式作为值构造器，数组/切片由于其固有的特性，采用index:value为其构造初值，主要应用在少数场合，比如为非连续（稀疏）元素构造初值（如上面示例中的numbers、fnumbers）​、让编译器根据最大元素下标值推导数组的大小

```go
numbers := [256]int{ "a": 8, "b", c: "4" }
var data = []int{ 0: 10, 1: -5, 3: 14 }
```

## map复合字面值

和结构体、数组/切片相比，map类型变量使用复合字面值作为初值构造器就显得自然许多，因为map类型具有原生的key:value构造形式

```go
var unitMap = map[string]int64 {
  "ns": int64(Nanosecond),
}
```